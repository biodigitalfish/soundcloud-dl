const d="soundcloud-dl-bridge";window.addEventListener("message",e=>{if(e.source!==window||!e.data||e.data.source!==d||e.data.direction!=="to-background-via-bridge")return;const r=e.data.payload,o=e.data.messageId;r&&r.type&&o?(console.debug(`[Bridge] Received from page for background (ID: ${o}):`,r),chrome.runtime.sendMessage(r,s=>{chrome.runtime.lastError?(console.error("[Bridge] Error sending message to background or receiving response:",chrome.runtime.lastError),window.postMessage({source:d,direction:"from-background-via-bridge",payload:{error:chrome.runtime.lastError.message,originalMessage:r},messageId:o},"*")):(console.debug(`[Bridge] Received response from background for ID ${o}, sending to page:`,s),window.postMessage({source:d,direction:"from-background-via-bridge",payload:s,messageId:o},"*"))})):console.warn("[Bridge] Received message from page is invalid or missing messageId:",e.data)}),chrome.runtime.onMessage.addListener((e,r,o)=>(r.id===chrome.runtime.id&&!r.tab&&window.postMessage({source:d,direction:"from-background-via-bridge",payload:e},"*"),!1)),console.debug("[SoundCloud DL] Bridge content script loaded and listening.");
