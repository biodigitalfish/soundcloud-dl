import{L as l}from"./logger-B3xayXxI.js";const u=l.create("Repost Blocker");function d(e){return e&&e.hostname==="api-v2.soundcloud.com"&&e.pathname==="/stream"}function a(e){const o=window.localStorage.getItem("SOUNDCLOUD-DL-"+e);return JSON.parse(o)}const c=864e3;function f(e){if(!e)return[];const o=new Date().getTime()/1e3,s=a("block-playlists"),r=a("followed-artists")??[],i=[];for(const t of e)if(t.type!=="track-promoted"){if(t.type==="track-repost"){if(!r.includes(t.track.user_id))continue;const n=new Date(t.track.created_at).getTime()/1e3;if(o-n>c)continue;t.type="track",t.user=t.track.user,t.created_at=t.track.display_date}if(!(s&&t.type==="playlist")){if(t.type==="playlist-repost"){if(s||!r.includes(t.playlist.user_id))continue;const n=new Date(t.playlist.created_at).getTime()/1e3;if(o-n>c)continue;t.type="playlist",t.user=t.playlist.user,t.created_at=t.playlist.display_date}i.push(t)}}return i}function y(e){if(!e)return e;const o=JSON.parse(e),s={...o,collection:f(o.collection)};return JSON.stringify(s)}const p=XMLHttpRequest.prototype.send;function h(e){try{if(this.__state){const o=new URL(this.__state.url),s=this.onload;s&&d(o)&&(this.onload=function(r){Object.defineProperty(this,"responseText",{value:y(this.responseText)}),s.call(this,r)})}}catch(o){u.logError("Error in hijackedSendMethod:",o)}return p.call(this,e)}XMLHttpRequest.prototype.send=h,Object.defineProperty(XMLHttpRequest.prototype,"resetSend",{value:()=>XMLHttpRequest.prototype.send=p});
