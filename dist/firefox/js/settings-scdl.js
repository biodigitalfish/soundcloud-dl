import{s,l as y,a as i,g as f,h as m}from"./config-scdl-CB4onbqr.js";import{L as g}from"./logger-scdl-C1suKzoJ.js";import{k as d}from"./compatibilityStubs-scdl-DBF9jRnU.js";const n=g.create("Settings");async function p(e){e.preventDefault(),n.logInfo("Resetting settings..."),await m(),await u()}async function b(e){e.preventDefault(),n.logInfo("Saving settings...");const o=[];for(const a of i){const c=document.querySelector(`#${a}`);if(c===null)continue;let l;if(c.type==="checkbox")l=c.checked;else if(c.type==="number"){if(l=c.valueAsNumber,isNaN(l)){n.logWarn(`Invalid number input for ${a}, skipping save.`);continue}}else l=c.value;o.push(s(a,l))}await Promise.all(o);const t=document.querySelector("button[type='submit']");if(t){const a=t.textContent;t.textContent="Saved!",t.disabled=!0,setTimeout(()=>{t.textContent=a,t.disabled=!1},1500)}}async function u(){n.logInfo("Restoring settings...");try{await y(),n.logInfo("Configuration loaded.");for(const e of i){const o=document.querySelector(`#${e}`);if(o===null)continue;const t=f(e);n.logInfo(`Restoring key: ${e}, Value: ${JSON.stringify(t)} (Type: ${typeof t})`),typeof t=="boolean"?o.checked=t:typeof t=="number"?o.value=String(t):typeof t=="string"?o.value=t:(n.logWarn(`Unexpected type for config key ${e}: ${typeof t}`),o.type==="checkbox"?o.checked=!1:o.value="");const a=new Event("change",{bubbles:!1,cancelable:!0});o.dispatchEvent(a)}}catch(e){n.logError("Failed to restore settings!",e)}}const h=document.querySelector("#download-without-prompt"),S=document.querySelector("#default-download-location");h.onchange=e=>{S.disabled=!e.target.checked};const k=document.querySelector("#block-reposts"),v=document.querySelector("#block-playlists");k.onchange=e=>{e.target.checked||(v.checked=!1)};const w=document.querySelector("#enable-hls-rate-limiting"),C=document.querySelector("#hls-rate-limit-delay-ms");w.onchange=e=>{C.disabled=!e.target.checked};const r=document.querySelector("#clear-download-history");async function q(){n.logInfo("Clearing download history...");try{await s("track-download-history",{}),n.logInfo("Attempting to clear browser download history for SoundCloud files..."),d("SoundCloud.*\\.(mp3|m4a|wav)$"),d("\\.(mp3|m4a|wav)$");const e=r.textContent;r.textContent="History Cleared!",r.disabled=!0,setTimeout(()=>{r.textContent=e,r.disabled=!1},2e3)}catch(e){n.logError("Failed to clear download history",e),r.textContent="Error! See Console",r.style.backgroundColor="#d30029",setTimeout(()=>{r.textContent="Clear Download History",r.style.backgroundColor="",r.disabled=!1},3e3)}}r.addEventListener("click",q),document.addEventListener("DOMContentLoaded",u),document.querySelector("form").addEventListener("submit",b),document.querySelector("form").addEventListener("reset",p);
