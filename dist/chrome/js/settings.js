import{f as s,o as i,k as y,m as d,a as f,A as m}from"./config-wCjb4n-R.js";import{L as g}from"./logger-B3xayXxI.js";const n=g.create("Settings");async function p(e){e.preventDefault(),n.logInfo("Resetting settings..."),await m(),await u()}async function b(e){e.preventDefault(),n.logInfo("Saving settings...");const o=[];for(const r of d){const c=document.querySelector(`#${r}`);if(c===null)continue;let l;if(c.type==="checkbox")l=c.checked;else if(c.type==="number"){if(l=c.valueAsNumber,isNaN(l)){n.logWarn(`Invalid number input for ${r}, skipping save.`);continue}}else l=c.value;o.push(s(r,l))}await Promise.all(o);const t=document.querySelector("button[type='submit']");if(t){const r=t.textContent;t.textContent="Saved!",t.disabled=!0,setTimeout(()=>{t.textContent=r,t.disabled=!1},1500)}}async function u(){n.logInfo("Restoring settings...");try{await y(),n.logInfo("Configuration loaded.");for(const e of d){const o=document.querySelector(`#${e}`);if(o===null)continue;const t=f(e);n.logInfo(`Restoring key: ${e}, Value: ${JSON.stringify(t)} (Type: ${typeof t})`),typeof t=="boolean"?o.checked=t:typeof t=="number"?o.value=String(t):typeof t=="string"?o.value=t:(n.logWarn(`Unexpected type for config key ${e}: ${typeof t}`),o.type==="checkbox"?o.checked=!1:o.value="");const r=new Event("change",{bubbles:!1,cancelable:!0});o.dispatchEvent(r)}}catch(e){n.logError("Failed to restore settings!",e)}}const h=document.querySelector("#download-without-prompt"),S=document.querySelector("#default-download-location");h.onchange=e=>{S.disabled=!e.target.checked};const k=document.querySelector("#block-reposts"),v=document.querySelector("#block-playlists");k.onchange=e=>{e.target.checked||(v.checked=!1)};const w=document.querySelector("#enable-hls-rate-limiting"),C=document.querySelector("#hls-rate-limit-delay-ms");w.onchange=e=>{C.disabled=!e.target.checked};const a=document.querySelector("#clear-download-history");async function q(){n.logInfo("Clearing download history...");try{await s("track-download-history",{}),n.logInfo("Attempting to clear browser download history for SoundCloud files..."),i("SoundCloud.*\\.(mp3|m4a|wav)$"),i("\\.(mp3|m4a|wav)$");const e=a.textContent;a.textContent="History Cleared!",a.disabled=!0,setTimeout(()=>{a.textContent=e,a.disabled=!1},2e3)}catch(e){n.logError("Failed to clear download history",e),a.textContent="Error! See Console",a.style.backgroundColor="#d30029",setTimeout(()=>{a.textContent="Clear Download History",a.style.backgroundColor="",a.disabled=!1},3e3)}}a.addEventListener("click",q),document.addEventListener("DOMContentLoaded",u),document.querySelector("form").addEventListener("submit",b),document.querySelector("form").addEventListener("reset",p);
