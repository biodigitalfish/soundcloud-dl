import{l}from"../../js/compatibilityStubs-scdl-DBF9jRnU.js";import"../../js/logger-scdl-C1suKzoJ.js";const r=console;r.log("Restore History page script loaded."),document.addEventListener("DOMContentLoaded",()=>{r.log("Restore History DOM loaded.");const c=document.getElementById("directory-upload"),t=document.getElementById("restore-status");if(!c||!t){r.error("Required UI elements (directory-upload or restore-status) not found!"),t&&(t.textContent="Error: Page UI elements missing.");return}c.addEventListener("change",async g=>{const n=g.target.files;if(n&&n.length>0){r.log(`[RestorePage] Selected ${n.length} files/directories. Processing immediately.`),t.textContent=`Selected ${n.length} items. Starting processing...`;const s=[];let d=0,a=0;for(const e of Array.from(n)){if(e.name.toLowerCase().endsWith(".m4a")){a++,t.textContent=`Processing file ${e.name}... (${d+1}/${n.length})`,r.log(`[RestorePage] Reading M4A file: ${e.name}`);try{const i=await e.arrayBuffer();r.log(`[RestorePage] Sending ${e.name} (size: ${i.byteLength}) to background for SCID extraction.`);const o=await l({type:"EXTRACT_SCID_FROM_M4A",payload:{filename:e.name,buffer:i}});o&&o.trackId?(r.log(`[RestorePage] Received SCID ${o.trackId} for ${e.name}`),s.push(o.trackId),t.textContent=`Found SCID ${o.trackId} in ${e.name}.`):o&&o.error?(r.warn(`[RestorePage] Error extracting SCID from ${e.name}: ${o.error}`),t.textContent=`Error for ${e.name}: ${o.error}.`):(r.warn(`[RestorePage] No SCID found or unknown error for ${e.name}`),t.textContent=`No SCID found in ${e.name}.`)}catch(i){r.error(`[RestorePage] Error processing file ${e.name}:`,i),t.textContent=`Error reading ${e.name}. See console.`}}d++}if(r.log("[RestorePage] Finished processing local files. M4A files found:",a,"Extracted SCIDs:",s),t.textContent=`Processed ${d} items. Found ${a} M4A files. Extracted ${s.length} track IDs.`,s.length>0){t.textContent+=" Sending to background to restore history...";try{const e=await l({type:"RESTORE_HISTORY_FROM_IDS",payload:{trackIds:s}});r.log("[RestorePage] Response from background after sending track IDs for history restore:",e),t.textContent=e?.message||"History restoration request sent. Check main extension for updates."}catch(e){r.error("[RestorePage] Error sending track IDs for history restore:",e),t.textContent="Error sending IDs for history restore. See console."}}else a>0?t.textContent="Processed M4A files, but no track IDs were extracted. Ensure files have SCID metadata.":t.textContent="No M4A files found in the selection. Please select a directory containing .m4a SoundCloud downloads."}else t.textContent="No directory selected or directory is empty. Please select a directory."})});
